<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Enviar UTMs para backend</title>
</head>

<body>
    <h2>Enviar dados UTM para backend</h2>

    <button id="sendUtmBtn">Enviar UTMs</button>

    <p id="response"></p>



    <script>

        function gerarUniqueClickId() {
            return 'click-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }



        // Função para pegar parâmetros da URL
        function pegarParametrosUrl() {
            const params = new URLSearchParams(window.location.search);
            const unique_click_id = gerarUniqueClickId();
            console.log(); // Ex: click-1754598741123-f3k9l2xwz

            return {
                unique_click_id: unique_click_id || 'default-unique-click-id',
                timestamp: Date.now(),
                valor: parseFloat(params.get('valor')) || 10.50,
                fbclid: params.get('fbclid') || null,
                utm_source: params.get('utm_source') || null,
                utm_medium: params.get('utm_medium') || null,
                utm_campaign: params.get('utm_campaign') || null,
                utm_content: params.get('utm_content') || null,
                utm_term: params.get('utm_term') || null,
                ip: '0.0.0.0' // você pode pegar o IP do backend ou deixar fixo aqui
            };
        }

        document.getElementById('sendUtmBtn').addEventListener('click', async () => {
            const dados = pegarParametrosUrl();

            try {
                const response = await fetch('http://localhost:3000/frontend-utm-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dados)
                });

                const text = await response.text();
                document.getElementById('response').textContent = `Resposta do servidor: ${text}`;
            } catch (err) {
                document.getElementById('response').textContent = `Erro: ${err.message}`;
            }
        });
    </script>
</body>

</html>